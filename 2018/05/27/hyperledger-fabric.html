<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <!-- JQuery (used for bootstrap and jekyll search) -->
    <script src="/assets/js/jquery-3.2.1.min.js" ></script>
    
    <!-- Main JS (navbar.js and katex_init.js)-->
    <script defer=true src="/assets/js/main.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <link rel="stylesheet" href="/assets/css/mermaid.css">

    <!--Favicon-->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- Canonical -->
    <link rel="canonical" href="http://localhost:4000/2018/05/27/hyperledger-fabric.html">

    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="小白" href="http://localhost:4000///feed.xml"/>

    <!-- Font Awesome -->
    <!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.min.css">

    <!-- Google Fonts -->
    
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css"> 
    

    <!-- KaTeX 0.8.3 -->
    
    <!--<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.js"></script> -->
    <link rel="stylesheet" type="text/css" href="/assets/css/katex.min.css">
    <script src="/assets/js/katex.min.js">
    </script>
    

    <!-- Google Analytics -->
    
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-89143952-2', 'auto');
        ga('send', 'pageview');

    </script>
    

    <!-- Baidu Analytics -->
    
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = 'https://hm.baidu.com/hm.js?2a8326534823f90fa4eef816aea2ef08';
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    </script>        
    
    
    <!-- seo tags -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>fabric - 架构&amp;执行流程 | 小白成长史</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="fabric - 架构&amp;执行流程" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="本文简单讲述fabric架构&amp;执行流程，帮助同学快速理解&amp;入门。" />
<meta property="og:description" content="本文简单讲述fabric架构&amp;执行流程，帮助同学快速理解&amp;入门。" />
<link rel="canonical" href="http://localhost:4000/2018/05/27/hyperledger-fabric.html" />
<meta property="og:url" content="http://localhost:4000/2018/05/27/hyperledger-fabric.html" />
<meta property="og:site_name" content="小白成长史" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-27T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"本文简单讲述fabric架构&amp;执行流程，帮助同学快速理解&amp;入门。","@type":"BlogPosting","url":"http://localhost:4000/2018/05/27/hyperledger-fabric.html","headline":"fabric - 架构&amp;执行流程","dateModified":"2018-05-27T00:00:00+08:00","datePublished":"2018-05-27T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/05/27/hyperledger-fabric.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Manual seo tags -->
    <!--
    <title>fabric - 架构&执行流程 | 小白</title>
    <meta name="description" content="本文简单讲述fabric架构&amp;执行流程，帮助同学快速理解&amp;入门。">
    -->
</head>

  <body>
    <header class="site-header">
    
    <!-- Logo and title -->
	<div class="branding">
		<a href="/">
			<img class="avatar" src="/assets/img/photo.jpeg" alt=""/>
		</a>

		<h1 class="site-title">
			<a href="/">小白</a>
		</h1>
	</div>
    
    <!-- Toggle menu -->
    <nav class="clear">
    <a id="pull" class="toggle" href="#">
    <i class="fa fa-bars fa-lg"></i>
    </a>
    
    <!-- Menu -->
    <ul>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
         
        
        
        
        <li class="separator">
            |
        </li>
        <li>
            <a class="clear" href="/search">
                <i class="fa fa-search" aria-hidden="true"></i>
            </a>
        </li>
        
        
        <li class="separator">
            |
        </li>
        <li>
            <a class="clear" href="/tags">
                <i class="fa fa-tags" aria-hidden="true"></i>
            </a>
        </li>
        
        
    </ul>
        
	</nav>
</header>

    <div class="content">
      <article >
  <header id="main" style="background-image: url('/')">
    <h1 id="fabric+-+%E6%9E%B6%E6%9E%84%26%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B" class="title">fabric - 架构&执行流程</h1>
    <p class="meta">
    May 27, 2018
    
    </p>
  </header>
  <section class="post-content"><p>本文简单讲述fabric架构&amp;执行流程，帮助同学快速理解&amp;入门。</p>

<h1 id="架构">架构</h1>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/1.jpeg" alt="1.jpeg" /></p>

<h2 id="identity">Identity</h2>

<p>Identity，也就是身份管理，Fabric是目前为止在设计上最贴近联盟链思想的区块链。联盟链考虑到商业应用对安全、隐私、监管、审计、性能的需求，提高准入门槛，成员必须被许可才能加入网络。Fabric成员管理服务为整个区块链网络提供身份管理、隐私、保密和可审计的服务。成员管理服务通过公钥基础设施PKI和去中心化共识机制使得非许可的区块链变成许可制的区块链。</p>

<h2 id="smart-contract">Smart Contract</h2>

<p>Fabric的智能合约smart contract称为链码chaincode，是一段代码，它处理网络成员所同意的业务逻辑。和以太坊相比，Fabric链码和底层账本是分开的，升级链码时并不需要迁移账本数据到新链码当中，真正实现了逻辑与数据的分离。</p>

<p>链码可采用Go、Java、Node.js语言编写。链码被编译成一个独立的应用程序，fabric用Docker容器来运行chaincode，里面的base镜像都是经过签名验证的安全镜像，包括OS层和开发chaincode的语言、runtime和SDK层。一旦chaincode容器被启动，它就会通过gRPC与启动这个chaincode的Peer节点连接。</p>

<h2 id="ledger--transcations">Ledger | Transcations</h2>

<p>Fabric使用建立在HTTP/2上的P2P协议来管理分布式账本。采取可插拔的方式来根据具体需求来设置共识协议，比如PBFT，Raft，PoW和PoS等。</p>

<h3 id="ledger">Ledger</h3>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/2.jpg" alt="2.jpg" /></p>

<p>如上图所示，账本Ledger主要包含两块：blockchain和state。blockchain就是一系列连在一起的block，用来记录历史交易。state对应账本的当前最新状态，它是一个key-value数据库，Fabric默认采用Level DB, 可以替换成其他的Key-value数据库，如Couch DB。举个例子。我们采用区块链实现一个弹珠交易的系统。我们开发了一个Chaincode,每个弹珠有以下几个属性：Name, owner, color, size.  可以定义一个JSON对象，用name做KEY, JSON对象做Value，存储在Level DB或者CouchDB中。</p>

<h3 id="transcation">transcation</h3>

<p>Fabric上的transction交易分两种，部署交易和调用交易。</p>

<ul>
  <li>部署交易  <br />
  把Chaincode部署到peer节点上并准备好被调用，当一个部署交易成功执行时，Chaincode就被部署到各个peer节点上。好比把一个web service或者EJB部署到应用服务器上的不同实例上。</li>
  <li>调用交易  <br />
  客户端应用程序通过Fabric提供的API调用先前已部署好的某个chaincode的某个函数执行交易，并相应地读取和写入KV数据库，返回是否成功或者失败。</li>
</ul>

<h3 id="apis-events-sdks">APIs, Events, SDKs</h3>

<p>Fabric提供API方便应用开发，对服务端的ChainCode，目前支持用Go、Java或者Node.js开发。对客户端应用，Fabric目前提供Node.js和Java SDK。未来计划提供Python 和Go SDK，Fabric还提供RESTAPI。对于开发者，还可以通过CLI快速去测试chaincode，或者去查询交易状态。在区块链网络里，节点和chaincode会发送events来触发一些监听动作，方便与其他外部系统的集成。</p>

<h1 id="执行流程">执行流程</h1>

<p>首先理解几个概念</p>

<ul>
  <li>MSP  <br />
  MSP(Membership Service Provider), 这类节点主管区块链网络中其他的节点的授权，准入，踢除。通过给不同节点颁发证书的方式，授予不同类型的节点相应的权限。</li>
  <li>Ordering Node  <br />
  中文可以称作排序节点。通常在一个网络中至少有一个或多个排序节点，这类节点负责 按照指定的算法，将交易进行排序，并返回给Committing Peer。其并不关心具体的交易细节。</li>
  <li>Endorsing Peer  <br />
  这类节点的主要负责接收交易请求，验证这笔交易之后，并做一些预处理之后，并将签名后的数据传回给客户端。</li>
  <li>Committing Peer  <br />
  这类节点做是区块链网络中的全节点，它们需要记录完整的区块信息，并且验证每笔交易的正确性，是最终将交易打包进区块链的节点。</li>
</ul>

<p>交易的执行路程如下</p>

<p>1.首先从客户端发起一笔交易提交到Endorsing Peer，进行预处理。</p>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/3.png" alt="3.png" /></p>

<p>2.预处理通过之后，将签名数据，传回给客户端。</p>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/4.png" alt="4.png" /></p>

<p>3.客户端发起请求，将收到的签名数据传给Ordering Node。</p>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/5.png" alt="5.png" /></p>

<p>4.Ordering Node对交易进行排序，然后传给Committing Peer。</p>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/6.png" alt="6.png" /></p>

<p>5.Committing Peer这里将排序好的交易进行验证，并打包，通过指定的共识算法达成一致，形成新的区块。</p>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/7.png" alt="7.png" /></p>

<p>6.最后将交易结果返回给客户端。</p>

<p><img src="/assets/img/posts/2018-05-27-hyperledger-fabric/8.png" alt="8.png" /></p>

<p>ps:中间过程的每一步，都伴随着权限的验证。会根据MSP颁发的证书，进行判断。</p>

<h1 id="参考">参考</h1>

<p><a href="https://blog.csdn.net/xcjing/article/details/78883642">Hyperledger Fabric 1.0架构及原理</a></p>

<p><a href="https://www.jianshu.com/p/eb33c7288ce7?from=timeline">超级账本之——Fabric</a></p>
</section>
   
   <!-- Tag list -->
  
  


<footer>
  <div class="tag-list">
    
      <div class="meta">Tags</div>
    

    
    <a class="button" href="/tags#fabric">
      <p><i class="fa fa-tag fa-fw"></i> fabric</p>
    </a>
    
    <a class="button" href="/tags#超级账本">
      <p><i class="fa fa-tag fa-fw"></i> 超级账本</p>
    </a>
    
  </div>
</footer>

    
</article>

<!-- Disqus -->


<!-- Post navigation -->

  <div id="post-nav">
  
  <div id="previous-post" class="post-nav-post">
      <p>Previous post</p>
      <a href="/2018/05/27/hyperledger-fabric-sdk.html">
        fabric - Node.js SDK
      </a>
  </div>
  
  
</div>

    </div>
    
<footer class="site-footer">
    <p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
	<a href="http://localhost:4000/feed.xml" title="Follow RSS feed">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>















<li>
	<a href="https://github.com/shadowdragons" title="Follow on GitHub">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>
































                </ul>
            </div>
</footer>




  </body>
</html>
